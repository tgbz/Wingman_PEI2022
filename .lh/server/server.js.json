{
    "sourceFile": "server/server.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1667058727778,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1667058741542,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -61,8 +61,12 @@\n \n // Routes\n app.use('/', require('./routes/index'));\n \n+\n+\n+\n+\n app.use(function (req, res, next) {\n     var err = new Error('Not Found');\n     err.status = 404;\n     next(err);\n"
                },
                {
                    "date": 1667752275312,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,29 +1,23 @@\n var express = require('express');\n var app = express();\n-\n //body parser for post requests\n var bodyParser = require('body-parser')\n-app.use(bodyParser.json({limit: '50mb'}));         // to support JSON-encoded bodies\n-app.use(bodyParser.urlencoded({\n-    limit : '50mb',\n-    // to support URL-encoded bodies\n-    extended: true,\n-    parameterLimit:50000\n-}));\n-\n var cors = require('cors')\n-const corsOpts = {\n-    origin: '*',\n-    credentials: true,\n-    methods: ['GET', 'PUT', 'POST', 'DELETE', 'OPTIONS'],\n-    allowedHeaders: ['Accept', 'Authorization', 'Cache-Control', 'Content-Type', 'DNT', 'If-Modified-Since', 'Keep-Alive', 'Origin', 'User-Agent', 'X-Requested-With', 'Content-Length']\n-}\n-app.use(cors(corsOpts))\n-app.options('*', cors(corsOpts))\n-\n //helmet (sets various HTTP headers to help protect the app)\n var helmet = require('helmet')\n+var path = require('path');\n+var logger = require('morgan');\n+var cookieParser = require('cookie-parser');\n+var dataBases = require('./config/database');\n+\n+//const MySQLStore = require('express-mysql-session')(session);\n+\n+app.use(express.static(path.join(__dirname, 'public')));\n+app.use(logger('dev'));\n+app.use(express.json());\n+app.use(cookieParser());\n+\n app.use(helmet({\n     //HSTS recommended config\n     hsts: {\n         maxAge: 31536000,\n@@ -36,37 +30,61 @@\n         }\n     }\n }))\n \n-var path = require('path');\n-var logger = require('morgan');\n-var cookieParser = require('cookie-parser');\n-var dataBases = require('./config/database');\n+const corsOpts = {\n+    origin: '*',\n+    credentials: true,\n+    methods: ['GET', 'PUT', 'POST', 'DELETE', 'OPTIONS'],\n+    allowedHeaders: ['Accept', 'Authorization', 'Cache-Control', 'Content-Type', 'DNT', 'If-Modified-Since', 'Keep-Alive', 'Origin', 'User-Agent', 'X-Requested-With', 'Content-Length']\n+}\n+app.use(cors(corsOpts))\n+app.options('*', cors(corsOpts))\n \n \n-app.use(express.static(path.join(__dirname, 'public')));\n \n \n-app.use(logger('dev'));\n-app.use(express.json());\n-app.use(cookieParser());\n-\n-\n var passport = require('passport');\n-const { application } = require('express');\n require('./config/passport')(passport);\n \n-//DB CONNECTION\n+/* \n+Middleware\n \n+Para guardar informação entre pedidos HTTP e sessões. \n+Quando um dado user visita o nosso site, este cria uma nova sessão para o user e atribui-lhe uma cookie.\n+Da próxima vez que o ser vai ao site, a cookie é verificada e a session id (que está guardara na cookie) é \n+obtida e é feita uma pesquisa na session store. Session store é um sitio onde todas as sessions são guardadas.\n+Aqui estamos um sítio onde podemos guardar toda a informação respectiva à sessão. Assim, estamos \n+*/\n \n \n-// Routes\n-app.use('/', require('./routes/index'));\n \n+//Inicializar o passport cada vez que uma rota é chamada\n+app.use(passport.initialize());\n \n+/* Funciona como middleware para alterar o objecto request e alterar o \"user\" value que é actualmente o session id (através do client cookie) */\n \n \n+/* Middleware responsável por realizar o parsing dos bodys de pedidos num middlware antes de os gerirmos */\n \n+app.use(bodyParser.json({limit: '50mb'}));         // to support JSON-encoded bodies\n+app.use(bodyParser.urlencoded({\n+    limit : '50mb',\n+    // to support URL-encoded bodies\n+    extended: true,\n+    parameterLimit:50000\n+}));\n+\n+/* É usado para servir ficheiros estáticos que se encontram na pasta public (css, imgs) */\n+app.use(express.static('public'))\n+\n+/* Para definir que estamos a usar ejs com o nosso view engine.  */\n+app.set(\"view engine\", \"pug\");\n+\n+// Routes\n+app.use('/', require('./routes/index'));\n+app.use('/users', require('./routes/users'));\n+\n app.use(function (req, res, next) {\n     var err = new Error('Not Found');\n     err.status = 404;\n     next(err);\n@@ -80,5 +98,11 @@\n     res.status(err.status || 500).send(`${err.message}`);\n     \n });\n \n+const PORT = process.env.PORT || 3000;\n+app.listen(PORT, () => {\n+  console.log(`Server is running on port ${PORT}.`);\n+});\n+\n+\n module.exports = app;\n"
                },
                {
                    "date": 1667752308553,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -45,24 +45,13 @@\n \n var passport = require('passport');\n require('./config/passport')(passport);\n \n-/* \n-Middleware\n \n-Para guardar informação entre pedidos HTTP e sessões. \n-Quando um dado user visita o nosso site, este cria uma nova sessão para o user e atribui-lhe uma cookie.\n-Da próxima vez que o ser vai ao site, a cookie é verificada e a session id (que está guardara na cookie) é \n-obtida e é feita uma pesquisa na session store. Session store é um sitio onde todas as sessions são guardadas.\n-Aqui estamos um sítio onde podemos guardar toda a informação respectiva à sessão. Assim, estamos \n-*/\n \n-\n-\n //Inicializar o passport cada vez que uma rota é chamada\n app.use(passport.initialize());\n \n-/* Funciona como middleware para alterar o objecto request e alterar o \"user\" value que é actualmente o session id (através do client cookie) */\n \n \n /* Middleware responsável por realizar o parsing dos bodys de pedidos num middlware antes de os gerirmos */\n \n"
                }
            ],
            "date": 1667058727778,
            "name": "Commit-0",
            "content": "var express = require('express');\nvar app = express();\n\n//body parser for post requests\nvar bodyParser = require('body-parser')\napp.use(bodyParser.json({limit: '50mb'}));         // to support JSON-encoded bodies\napp.use(bodyParser.urlencoded({\n    limit : '50mb',\n    // to support URL-encoded bodies\n    extended: true,\n    parameterLimit:50000\n}));\n\nvar cors = require('cors')\nconst corsOpts = {\n    origin: '*',\n    credentials: true,\n    methods: ['GET', 'PUT', 'POST', 'DELETE', 'OPTIONS'],\n    allowedHeaders: ['Accept', 'Authorization', 'Cache-Control', 'Content-Type', 'DNT', 'If-Modified-Since', 'Keep-Alive', 'Origin', 'User-Agent', 'X-Requested-With', 'Content-Length']\n}\napp.use(cors(corsOpts))\napp.options('*', cors(corsOpts))\n\n//helmet (sets various HTTP headers to help protect the app)\nvar helmet = require('helmet')\napp.use(helmet({\n    //HSTS recommended config\n    hsts: {\n        maxAge: 31536000,\n        includeSubDomains: true,\n        preload: true\n    },\n    contentSecurityPolicy: {\n        directives: {\n            defaultSrc: [\"'none'\"]\n        }\n    }\n}))\n\nvar path = require('path');\nvar logger = require('morgan');\nvar cookieParser = require('cookie-parser');\nvar dataBases = require('./config/database');\n\n\napp.use(express.static(path.join(__dirname, 'public')));\n\n\napp.use(logger('dev'));\napp.use(express.json());\napp.use(cookieParser());\n\n\nvar passport = require('passport');\nconst { application } = require('express');\nrequire('./config/passport')(passport);\n\n//DB CONNECTION\n\n\n\n// Routes\napp.use('/', require('./routes/index'));\n\napp.use(function (req, res, next) {\n    var err = new Error('Not Found');\n    err.status = 404;\n    next(err);\n});\n\n// error handler\napp.use(function (err, req, res, next) {\n    // set locals, only providing error in development\n    res.locals.message = err.message;\n    res.locals.error = req.app.get('env') === 'development' ? err : {};\n    res.status(err.status || 500).send(`${err.message}`);\n    \n});\n\nmodule.exports = app;\n"
        }
    ]
}